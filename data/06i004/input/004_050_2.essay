FROM composer:${COMPOSER_VERSION}
ARG COMPOSER_VERSION=2.7

ENV APP_DIR=/composer
WORKDIR $APP_DIR

COPY --builder ./site/composer.json $APP_DIR/

RUN composer install

FROM php:${PHP_VERSION}-fpm
ARG PHP_VERSION=8.1

COPY ${APP_DIR}/vendor /var/www/html/

COPY . /var/www/html/